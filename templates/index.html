<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/static/img/favicon.ico" />
    <link rel="stylesheet" href="/static/globals.css" />
    <link rel="stylesheet" href="/static/style.css?v=2" />
  </head>

  <body>
    <div class="box">
      <h3>
        <a href="http://brandscope.ap-northeast-2.elasticbeanstalk.com">Brand Scope</a>
      </h3>
      <div class="rectangle">
        <div class="overlap">
          <a href="http://brandscope.ap-northeast-2.elasticbeanstalk.com">
            <img class="university-element" src="/static/img/universitylogo.png" />
          </a>
        </div>
        <form id="searchForm" form action="/search" method="GET" class="search-form">
          <input
            type="text"
            name="main-search"
            placeholder="ë¸Œëœë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”. ë¶„ì„ì— 1ë¶„ ì´ìƒì˜ ì‹œê°„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            class="search-input-first"
          />
          <button type="submit" class="search-btn">
            <img
              src="../static/img/magnifier.png"
              alt="ë‹ë³´ê¸° ì•„ì´ì½˜"
              class="search-icon"
            />
          </button>
        </form>
      </div>
    </div>

    <div class="dashboard-container">
      <div class="card card-small">
        <div class="circle what">
          <svg
              width="48"
              height="48"
              viewBox="0 0 48 48"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M44 24C44 35.0457 35.0457 44 24 44M44 24C44 12.9543 35.0457 4 24 4M44 24H36M24 44C12.9543 44 4 35.0457 4 24M24 44V36M4 24C4 12.9543 12.9543 4 24 4M4 24H12M24 4V12"
                stroke="#D01993"
                stroke-width="4"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
        </div>
        <div class="littletitle">
          <h4>ì´ìŠˆ í™•ì‚° í¬ì¸íŠ¸</h4>
          <b id="truepoint"></b>
          <h6 id="last-month">*ì¼ì •ìˆ˜ì¤€ ì´ìƒì˜ ê²€ìƒ‰ëŸ‰ ê¸‰ì¦ì„ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨</h6>
        </div>
      </div>
      <div class="card card-small">
        <div class="circle calendar">
          <svg
            width="48"
            height="48"
            viewBox="0 0 48 48"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M32 4V12M16 4V12M6 20H42M10 8H38C40.2091 8 42 9.79086 42 12V40C42 42.2091 40.2091 44 38 44H10C7.79086 44 6 42.2091 6 40V12C6 9.79086 7.79086 8 10 8Z"
              stroke="#251EF3"
              stroke-width="4"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <div class="littletitle">
          <h4>ìµœë‹¤ ì–¸ê¸‰ëŸ‰ ì¼ì</h4>
          <b id="mostdate"></b>
        </div>
      </div>
      <div class="card card-small">
        <div class="circle updown">
          <svg
            id="arrow-down"
            width="48"
            height="48"
            viewBox="0 0 48 48"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M46 36L27 17L17 27L2 12M46 36H34M46 36V24"
              stroke="#9C5C04"
              stroke-width="4"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <svg
            id="arrow-up"
            width="48"
            height="48"
            viewBox="0 0 48 48"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M46 12L27 31L17 21L2 36M46 12H34M46 12V24"
              stroke="#9C5C04"
              stroke-width="4"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <div class="littletitle">
          <h4>ì–¸ê¸‰ëŸ‰ ì¦ê°ë¥ </h4>
          <b id="change"></b>
        </div>
        <h6 id="last-month">*ì§€ë‚œ 30ì¼ ëŒ€ë¹„</h6>
      </div>

      <div class="card card-wide">
        <div class="card-title-container">
          <h2>ì–¸ê¸‰ëŸ‰ ì¶”ì´ ê·¸ë˜í”„</h2>
          <div class="toggle-buttons">
            <button class="toggle-btn active" data-frequency="weekly">ì£¼ë³„</button>
            <button class="toggle-btn" data-frequency="monthly">ì›”ë³„</button>
          </div>
        </div>
        {% if data %}
        <img id="frequency-graph" src="{{ data.visualization_urls.weekly_frequency }}" alt="ì–¸ê¸‰ëŸ‰ ì¶”ì´ ê·¸ë˜í”„" style="width: 100%; height: auto;">
        {% else %}
        <div class="graph-placeholder"></div>
        {% endif %}
      </div>

      <div class="side-cards-container">
        <div class="card card-side-second">
          <div class="card-title-container">
            <h2>ê²€ìƒ‰ì–´ ê´€ë ¨ ê²Œì‹œë¬¼</h2>
            <div class="total-count">
              ì´ <span id="total">000</span>ê°œ
            </div>
          </div>
          <div id="sns-list-container">
            <div class="sns1">
              <div class="title-wrapper">
                <img
                  src="/static/img/google_icon.png"
                  alt="êµ¬ê¸€ ì•„ì´ì½˜"
                  class="sns-icon"
                />
                <p>OOOì‹¤ì œ í›„ê¸°(ê´‘ê³ X) (ì˜ˆì‹œ)</p>
              </div>
              <div class="meta-wrapper">
                <span>ì‘ì„±ì</span>
                <span>ì‘ì„±ë‚ ì§œ</span>
              </div>
            </div>
            </div>
        </div>
      </div>

      <div class="card card-graph">
        <div class="third header">
          <span class="icon"
            ><svg
              width="32"
              height="32"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M9.33329 14.6667L14.6666 2.66666C15.7275 2.66666 16.7449 3.08808 17.4951 3.83823C18.2452 4.58838 18.6666 5.60579 18.6666 6.66666V12H26.2133C26.5998 11.9956 26.9827 12.0753 27.3354 12.2336C27.6881 12.3919 28.0021 12.625 28.2558 12.9167C28.5094 13.2084 28.6966 13.5518 28.8044 13.923C28.9122 14.2942 28.938 14.6845 28.88 15.0667L27.04 27.0667C26.9435 27.7025 26.6205 28.2821 26.1305 28.6987C25.6405 29.1152 25.0164 29.3406 24.3733 29.3333H9.33329M9.33329 14.6667V29.3333M9.33329 14.6667H5.33329C4.62605 14.6667 3.94777 14.9476 3.44767 15.4477C2.94758 15.9478 2.66663 16.6261 2.66663 17.3333V26.6667C2.66663 27.3739 2.94758 28.0522 3.44767 28.5523C3.94777 29.0524 4.62605 29.3333 5.33329 29.3333H9.33329"
                stroke="#23AF00"
                stroke-width="4"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <svg
              width="32"
              height="32"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M22.6667 17.3333L17.3334 29.3333C16.2725 29.3333 15.2551 28.9119 14.5049 28.1618C13.7548 27.4116 13.3334 26.3942 13.3334 25.3333V20H5.78671C5.40016 20.0044 5.01729 19.9247 4.66461 19.7664C4.31193 19.6081 3.99789 19.375 3.74423 19.0833C3.49057 18.7916 3.30337 18.4483 3.19559 18.077C3.08781 17.7058 3.06203 17.3155 3.12004 16.9333L4.96004 4.93335C5.05647 4.29747 5.37946 3.71787 5.8695 3.30134C6.35954 2.88481 6.9836 2.65941 7.62671 2.66668H22.6667M22.6667 17.3333V2.66668M22.6667 17.3333H26.2267C26.9813 17.3467 27.7146 17.0825 28.2873 16.5909C28.8599 16.0993 29.2322 15.4146 29.3334 14.6667V5.33335C29.2322 4.58543 28.8599 3.90068 28.2873 3.40911C27.7146 2.91753 26.9813 2.65334 26.2267 2.66668H22.6667"
                stroke="#E40303"
                stroke-width="4"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </span>
          <h2>ê°ì„± ë¶„ì„</h2>
        </div>
        <div class="three three-content">
          <div class="sentiment-section">
            <div class="sentiment-analysis">
              <div class="analysis-box">
                <div class="thumbs-updown">
                  <svg
                    class="positiveIcon"
                    width="32px"
                    height="32px"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M9.33329 14.6667L14.6666 2.66666C15.7275 2.66666 16.7449 3.08808 17.4951 3.83823C18.2452 4.58838 18.6666 5.60579 18.6666 6.66666V12H26.2133C26.5998 11.9956 26.9827 12.0753 27.3354 12.2336C27.6881 12.3919 28.0021 12.625 28.2558 12.9167C28.5094 13.2084 28.6966 13.5518 28.8044 13.923C28.9122 14.2942 28.938 14.6845 28.88 15.0667L27.04 27.0667C26.9435 27.7025 26.6205 28.2821 26.1305 28.6987C25.6405 29.1152 25.0164 29.3406 24.3733 29.3333H9.33329M9.33329 14.6667V29.3333M9.33329 14.6667H5.33329C4.62605 14.6667 3.94777 14.9476 3.44767 15.4477C2.94758 15.9478 2.66663 16.6261 2.66663 17.3333V26.6667C2.66663 27.3739 2.94758 28.0522 3.44767 28.5523C3.94777 29.0524 4.62605 29.3333 5.33329 29.3333H9.33329"
                      stroke="#23AF00"
                      stroke-width="4"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <svg
                    class="negativeIcon"
                    width="32px"
                    height="32px"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M22.6667 17.3333L17.3334 29.3333C16.2725 29.3333 15.2551 28.9119 14.5049 28.1618C13.7548 27.4116 13.3334 26.3942 13.3334 25.3333V20H5.78671C5.40016 20.0044 5.01729 19.9247 4.66461 19.7664C4.31193 19.6081 3.99789 19.375 3.74423 19.0833C3.49057 18.7916 3.30337 18.4483 3.19559 18.077C3.08781 17.7058 3.06203 17.3155 3.12004 16.9333L4.96004 4.93335C5.05647 4.29747 5.37946 3.71787 5.8695 3.30134C6.35954 2.88481 6.9836 2.65941 7.62671 2.66668H22.6667M22.6667 17.3333V2.66668M22.6667 17.3333H26.2267C26.9813 17.3467 27.7146 17.0825 28.2873 16.5909C28.8599 16.0993 29.2322 15.4146 29.3334 14.6667V5.33335C29.2322 4.58543 28.8599 3.90068 28.2873 3.40911C27.7146 2.91753 26.9813 2.65334 26.2267 2.66668H22.6667"
                      stroke="#E40303"
                      stroke-width="4"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <div>
                  <input
                    type="range"
                    class="custom-slider"
                    min="0"
                    max="100"
                    value="50"
                    step="1"
                    disabled
                  />
                </div>
                <p class="label"></p>
                <p class="percent-label"></p>
              </div>
            </div>
          </div>
          <div class="visualization-area">
            {% if data %}
            <img src="/static/img/sentiment_combined_wc.png" alt="í†µí•© ì›Œë“œí´ë¼ìš°ë“œ" style="width: 100%; height: auto;">
            {% else %}
            <div class="graph-placeholder small"></div>
            {% endif %}
          </div>
          <div class="keyword-ranking">
            <h2>ê¸ì •/ë¶€ì • ì–¸ê¸‰ ë‹¨ì–´ ìˆœìœ„</h2>
            <ol class="ranking-list"></ol>
          </div>
        </div>
      </div>

      <div class="card card-graph3">
        <div class="card-title-container">
          <img
            src="/static//img/cross_line.png"
            alt="êµì°¨ë¶„ì„"
            class="cross-icon"
          />
          <h2>ê²€ìƒ‰ëŸ‰-ì–¸ê¸‰ëŸ‰ êµì°¨ ë¶„ì„</h2>
        </div>
        {% if data %}
        <img src="{{ data.visualization_urls.combined_trend }}" alt="êµì°¨ ë¶„ì„ ê·¸ë˜í”„" style="width: 100%; height: auto;">
        {% else %}
        <div class="graph-placeholder large"></div>
        {% endif %}
      </div>
      

      <div class="card card-graph2">
        <div class="graph2-title">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M33 7.00003C33.7956 6.20438 34.8748 5.75739 36 5.75739C36.5572 5.75739 37.1088 5.86712 37.6236 6.08034C38.1383 6.29355 38.606 6.60606 39 7.00003C39.394 7.39399 39.7065 7.8617 39.9197 8.37644C40.1329 8.89118 40.2426 9.44287 40.2426 10C40.2426 10.5572 40.1329 11.1089 39.9197 11.6236C39.7065 12.1384 39.394 12.6061 39 13L14 38L6 40L8 32L33 7.00003Z" stroke="#1E1E1E" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            <div>
              <h2>AI ë¶„ì„ ë¦¬í¬íŠ¸</h2>
            </div>
          </svg>
        </div>
        <div class="report-content">
          <div class="report-scroll-box">
            <div class="markdown-body">
              <style>
                  .markdown-body h3, .markdown-body h4 { margin-top: 20px; margin-bottom: 10px; color: #2c3e50; }
                  .markdown-body strong { color: #d35400; background-color: #fff3cd; padding: 0 4px; border-radius: 4px; }
                  .markdown-body ul { padding-left: 20px; margin-bottom: 15px; }
                  .markdown-body li { margin-bottom: 5px; }
                  .markdown-body hr { border: 0; height: 1px; background: #ddd; margin: 20px 0; }
              </style>
                {{ data.ai_report | default('AI ë¦¬í¬íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆê±°ë‚˜ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.', true) | safe }}
            </div>
        </div>
        </div>
      </div>

    <div class="card card-graph4">
      <div class="card-title-container">
        <div class="title-with-arrow">
          <h2>ê²½ìŸì‚¬ ë¹„êµ</h2>
          <span class="dropdown-arrow"></span> </div>
        
        <form id="competitorForm" action="/search" method="GET" class="search-form">
  
        <input type="hidden" name="main-search" value="{{ data.query if data else '' }}">

        <input
          type="text"
          name="competitor-search"
          placeholder="ë¹„êµí•˜ê³  ì‹¶ì€ ê²½ìŸì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”."
          class="search-input"
        />
        <button type="submit" class="search-btn">
          <img
            src="/static/img/magnifier.png"
            alt="ë‹ë³´ê¸° ì•„ì´ì½˜"
            class="search-icon"
          />
        </button>
      </form>
      </div>
      <div style="display: flex; justify-content: center;">
        {% if data and data.visualization_urls and data.visualization_urls.competitor_comparison %}
          <img src="{{ data.visualization_urls.competitor_comparison }}" alt="ê²½ìŸì‚¬ ë¹„êµ ê·¸ë˜í”„" style="width: 50%; height: auto;">
        {% else %}
          <div class="graph-placeholder large">
            ê²½ìŸì‚¬ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ë¶„ì„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
          </div>
        {% endif %}
      </div>
      <div id="competitor-loader">
        <div class="spinner"></div>
        <p class="loading-text">ê²½ìŸì‚¬ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...<br>(ì•½ 30ì´ˆ ì†Œìš”)</p>
      </div>
    </div>
  </div>

  <footer class="footer-area">
    <div class="footer-zone">
      <div class="out-name">
        <p>202001934 ì‹ ë´‰ê·¼ </p>
        <span>Â·</span>
        <p>202001926 ê¹€ì¼ê±´ </p>
        <span>Â·</span>
        <p>202101916 ì´í˜œì—°</p>
      </div>
        <span>Â·</span>
        <p>bgshin0115@naver.com </p>
        <span>Â·</span>
        <p>Copyright Â© 2025 Brand_Scope. All rights reserved.</p>
    </div>
  </footer>
  <div id="global-loader">
    <div class="spinner"></div>
    <p class="loading-text">ë¸Œëœë“œ í‰íŒì„ ë¶„ì„í•˜ê³  ë¦¬í¬íŠ¸ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤... ğŸ¤–<br>(ì•½ 1ë¶„ ì†Œìš”)</p>
  </div>

    {% if data %}
    <script>
    const competitorForm = document.getElementById('competitorForm');
    const searchInputMain = document.querySelector('.search-input-first'); // main-search ì…ë ¥ í•„ë“œ
    const searchInputCompetitor = document.querySelector('.search-input');  // competitor-search ì…ë ¥ í•„ë“œ

    // --- ğŸš€ ë‘ ë²ˆì§¸ í¼ ì œì¶œ í•¸ë“¤ëŸ¬ (Hidden Field ì—†ì´ ê°’ ìœ ì§€) ---
    if (competitorForm && searchInputMain && searchInputCompetitor) {

        competitorForm.addEventListener('submit', (event) => {

            event.preventDefault(); // ğŸ‘ˆ í¼ì˜ ê¸°ë³¸ ì œì¶œ ë™ì‘(ìƒˆë¡œê³ ì¹¨)ì„ ë§‰ìŠµë‹ˆë‹¤.

            const mainQuery = searchInputMain.value;
            const competitorQuery = searchInputCompetitor.value;

            // í¼ì˜ action URLì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const actionUrl = competitorForm.getAttribute('action'); // ì˜ˆ: /compare_competitor

            // URL íŒŒë¼ë¯¸í„°ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.
            const params = new URLSearchParams();

            // 1. **í˜„ì¬ í¼ì˜ ê°’** (ê²½ìŸì‚¬ ê²€ìƒ‰ì–´)ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
            if (competitorQuery) {
                // ì´ ê°’ì€ í¼ì˜ input name="competitor-search"ì—ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.
                params.set('competitor-search', competitorQuery);
            }

            // 2. **ìœ ì§€í•  ê°’** (ë©”ì¸ ê²€ìƒ‰ì–´)ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
            if (mainQuery) {
                // ì²« ë²ˆì§¸ ì…ë ¥ í•„ë“œì˜ ê°’ì„ ê°•ì œë¡œ URL íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€í•©ë‹ˆë‹¤.
                params.set('main-search', mainQuery); 
            }

            // 3. êµ¬ì„±ëœ íŒŒë¼ë¯¸í„°ë¡œ í˜ì´ì§€ë¥¼ ì´ë™ì‹œí‚µë‹ˆë‹¤.
            const newUrl = `${actionUrl}?${params.toString()}`;
            window.location.href = newUrl; 
        });
    }

    // --- ğŸš€ (ì„ íƒ ì‚¬í•­) ì²« ë²ˆì§¸ í¼ì—ë„ ë™ì¼í•œ ë¡œì§ ì ìš© ---
    // ë§Œì•½ ì²« ë²ˆì§¸ í¼ ì œì¶œ ì‹œì—ë„ ë‘ ë²ˆì§¸ ê²€ìƒ‰ì–´ ê°’ì„ ìœ ì§€í•˜ê³  ì‹¶ë‹¤ë©´,
    const searchForm = document.getElementById('searchForm');

    if (searchForm && searchInputMain && searchInputCompetitor) {
        searchForm.addEventListener('submit', (event) => {
            event.preventDefault(); 

            const mainQuery = searchInputMain.value;
            const competitorQuery = searchInputCompetitor.value;

            const actionUrl = searchForm.getAttribute('action'); // ì˜ˆ: http://127.0.0.1:8000/search

            const params = new URLSearchParams();
            if (mainQuery) {
                params.set('main-search', mainQuery);
            }
            if (competitorQuery) {
                params.set('competitor-search', competitorQuery); 
            }

            const newUrl = `${actionUrl}?${params.toString()}`;
            window.location.href = newUrl;
        });
    }

    // --- 4. í˜ì´ì§€ ë¡œë“œ ì‹œ URL íŒŒë¼ë¯¸í„°ë¥¼ ì½ì–´ ê°’ ì±„ìš°ê¸° (ê¸°ì¡´ ë¡œì§) ---
    const urlParams = new URLSearchParams(window.location.search);
    const mainQueryFromUrl = urlParams.get('main-search'); 
    const competitorQueryFromUrl = urlParams.get('competitor-search'); 

    if (searchInputMain && mainQueryFromUrl) {
        searchInputMain.value = mainQueryFromUrl;
    }

    if (searchInputCompetitor && competitorQueryFromUrl) {
        searchInputCompetitor.value = competitorQueryFromUrl;
    }

        // ----------------------------------------------------
        // 1. Jinja ë³€ìˆ˜ë¡œë¶€í„° ì´ˆê¸° ë°ì´í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (DOMContentLoaded ì™¸ë¶€: ì•ˆì •)
        // ----------------------------------------------------
        // ğŸ’¡ ë‹¨ìˆœ ë¬¸ìì—´ ë³€ìˆ˜: JSON.parse ì œê±°
        const newMostdateValue = {{ data.most_frequent_date | tojson }};
        const newChangeValueRaw = {{ data.mention_change_rate | tojson }}; 
        const newTruepointValueRaw = {{ data.outbreak_weeks[0] | default('N/A', true) | tojson }};
        const positivePercentage = {{ data.positive_percentage | default(50.0) }};
        const allData = {{ data.post_list | tojson }};
        const topKeywordsData = {{ data.top_keywords | tojson }};

        // ----------------------------------------------------
        // ğŸ“¢ ë°ì´í„° í™•ì¸ìš© CONSOLE LOG ì¶”ê°€ (ê°€ì¥ ì¤‘ìš”)
        // ----------------------------------------------------
        console.log("--- ì„œë²„ ë°ì´í„° ìˆ˜ì‹  í™•ì¸ ---");
        console.log("positivePercentage:", positivePercentage);
        console.log("allData (ì´ ê°œìˆ˜):", allData ? allData.length : 0);
        console.log("topKeywordsData (ìƒìœ„ í‚¤ì›Œë“œ):", topKeywordsData);
        console.log("----------------------------");
        
      // ----------------------------------------------------
      // ğŸ” ë‚ ì§œ ì¶”ì¶œ ë¡œì§ ì ìš© (newTruepointValue)
      // ----------------------------------------------------
      let newTruepointValue;
      if (newTruepointValueRaw && String(newTruepointValueRaw) !== 'N/A') {
          
          // ë„ì–´ì“°ê¸°(' ')ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¬¸ìì—´ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤.
          const parts = String(newTruepointValueRaw).split(' ');
          
          // '2025ë…„', '11ì›”', '(45ì£¼ì°¨)' ì„¸ ë¶€ë¶„ì„ í•©ì¹©ë‹ˆë‹¤.
          if (parts.length >= 4) { 
              newTruepointValue = `${parts[0]} ${parts[1]} ${parts[2]} ${parts[3]}`; 
          } else {
              newTruepointValue = String(newTruepointValueRaw);
          }
      }


        // ----------------------------------------------------
        // 2. DOMContentLoaded ë‚´ë¶€: ëª¨ë“  DOM ì¡°ì‘ ë¡œì§
        // ----------------------------------------------------
        document.addEventListener('DOMContentLoaded', () => {
            

            // --- 2A. ì´ˆê¸° ë°ì´í„° ë° ì¦ê°ë¥  ì„¤ì • (ID ê¸°ë°˜) ---
            const mostdateElement = document.getElementById('mostdate');
            const truepointElement = document.getElementById('truepoint');
            const changeElement = document.getElementById('change');

            // ì¶”ê°€: SVG í™”ì‚´í‘œ ìš”ì†Œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const arrowUpElement = document.getElementById('arrow-up');
            const arrowDownElement = document.getElementById('arrow-down');

            if (mostdateElement) mostdateElement.textContent = newMostdateValue;
            if (truepointElement) truepointElement.textContent = newTruepointValue;

            const changeValue = parseFloat(newChangeValueRaw);

            // í™”ì‚´í‘œ ì´ˆê¸° ìˆ¨ê¹€ í•¨ìˆ˜ (ì¬ì‚¬ìš©ì„ ìœ„í•´)
            const hideArrows = () => {
                if (arrowUpElement) arrowUpElement.style.display = 'none';
                if (arrowDownElement) arrowDownElement.style.display = 'none';
            };

            // í™”ì‚´í‘œ ì´ˆê¸° ìˆ¨ê¹€
            hideArrows();

            if (changeElement && !isNaN(changeValue)) {
                if (changeValue > 0) {
                    changeElement.textContent = `â–² ${changeValue.toFixed(1)}%`;
                    changeElement.style.color = '#00C853'; // ë…¹ìƒ‰
                    
                    // ìƒìŠ¹: arrow-up í‘œì‹œ
                    if (arrowUpElement) arrowUpElement.style.display = 'block';
                    
                } else if (changeValue < 0) {
                    changeElement.textContent = `â–¼ ${Math.abs(changeValue).toFixed(1)}%`;
                    changeElement.style.color = '#F44336'; // ë¹¨ê°„ìƒ‰
                    
                    // í•˜ë½: arrow-down í‘œì‹œ
                    if (arrowDownElement) arrowDownElement.style.display = 'block';
                    
                } else {
                    changeElement.textContent = `0.0%`;
                    changeElement.style.color = '#888'; // íšŒìƒ‰
                    
                    // ë³€í™” ì—†ìŒ: í™”ì‚´í‘œ ìˆ¨ê¹€ (ì´ë¯¸ ìœ„ì—ì„œ hideArrows()ë¡œ ì²˜ë¦¬ë˜ì—ˆì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ ë‹¤ì‹œ í˜¸ì¶œ ê°€ëŠ¥)
                    // hideArrows(); 
                }
            } else if (changeElement) {
                changeElement.textContent = `N/A`;
                changeElement.style.color = '#888';
                
                // ìœ íš¨í•˜ì§€ ì•Šì€ ê°’: í™”ì‚´í‘œ ìˆ¨ê¹€
                // hideArrows();
            }

            // ----------------------------------------------------
            // --- 2B. ğŸ’¡ ê°ì„± ë¶„ì„ ìŠ¬ë¼ì´ë”, ì•„ì´ì½˜, ë ˆì´ë¸” ì„¤ì • (ìˆ˜ì •ë¨) ---
            // ----------------------------------------------------
            const customSlider = document.querySelector('.custom-slider');
            const positiveIcon = document.querySelector('.positiveIcon');
            const negativeIcon = document.querySelector('.negativeIcon');
            const label = document.querySelector('.label');
            const percentLabel = document.querySelector('.percent-label'); // ğŸ’¡ ë°±ë¶„ìœ¨ ë ˆì´ë¸” ìš”ì†Œ ì¶”ê°€
            
            // 1. ìŠ¬ë¼ì´ë” ê°’ ì„¤ì •
            if (customSlider) {
                customSlider.value = positivePercentage;
            }

            // 2. ì•„ì´ì½˜ ë° í…ìŠ¤íŠ¸ ë ˆì´ë¸” ì„¤ì •
            if (positiveIcon && negativeIcon && label && percentLabel) { 
                // ë°±ë¶„ìœ¨ í‘œì‹œ (ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ê¹Œì§€)
                percentLabel.textContent = `${positivePercentage.toFixed(1)}%`;
                
                if (positivePercentage >= 50) {
                    positiveIcon.style.display = 'block';
                    negativeIcon.style.display = 'none';
                    label.textContent = "ê¸ì •";
                } else {
                    positiveIcon.style.display = 'none';
                    negativeIcon.style.display = 'block';
                    label.textContent = "ë¶€ì •";
                }
            } else {
                // ìš”ì†Œê°€ ëˆ„ë½ëœ ê²½ìš° ì½˜ì†” ê²½ê³ 
                console.warn("ê°ì„± ë¶„ì„ ì„¹ì…˜ì˜ í•„ìˆ˜ DOM ìš”ì†Œ(slider, icons, labels)ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }

            // --- 2C. í‚¤ì›Œë“œ ìˆœìœ„ ëª©ë¡ ë Œë”ë§ ---
            const rankingList = document.querySelector('.keyword-ranking .ranking-list'); 

            // topKeywordsDataëŠ” ì´ë¯¸ ë°°ì—´ì´ë©°, ê° ìš”ì†ŒëŠ” í‚¤ì›Œë“œ ê°ì²´ì…ë‹ˆë‹¤.
            // ë³„ë„ì˜ ë³€í™˜(map) ê³¼ì • ì—†ì´ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

            if (rankingList && Array.isArray(topKeywordsData) && topKeywordsData.length > 0) {
                //rankingList.innerHTML = ''; 

                // 'ì–¸ê¸‰ íšŸìˆ˜' í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœëŒ“ê°’(maxCount)ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
                const maxCount = topKeywordsData[0]['ì–¸ê¸‰ íšŸìˆ˜']; 
                const keywordsToDisplay = topKeywordsData.slice(0, 20); 

                keywordsToDisplay.forEach((item, index) => {
                    const listItem = document.createElement('li');
                    
                    // í•œê¸€ í‚¤ì›Œë“œì— ì ‘ê·¼í•˜ì—¬ ë³€ìˆ˜ì— í• ë‹¹í•©ë‹ˆë‹¤.
                    const keyword = item['í‚¤ì›Œë“œ'];
                    const count = item['ì–¸ê¸‰ íšŸìˆ˜'];

                    const barWidth = (count / maxCount) * 100;
                    
                    // ğŸš¨ ìˆ˜ì •ëœ ë¶€ë¶„: ë­í¬ì™€ íšŸìˆ˜ spanì„ ì œê±°í•˜ê³  í‚¤ì›Œë“œ ì´ë¦„ë§Œ ë‚¨ê¹ë‹ˆë‹¤.
                    listItem.innerHTML = `
                        <div class="ranking-bar">${keyword}</div>
                    `;
                    
                    rankingList.appendChild(listItem);
                });
            } else if (rankingList) {
                rankingList.innerHTML = '<li><p>ë¶„ì„ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p></li>';
            }


        // --- 2D. ë¬´í•œ ìŠ¤í¬ë¡¤ ë¡œì§ ---
        // =================================================================
        // 1. SNS ëª©ë¡ ì»¨í…Œì´ë„ˆ ë° ìŠ¤í¬ë¡¤ ìš”ì†Œ ì •ì˜
        // =================================================================

        const totalElement = document.getElementById('total');
        const container = document.getElementById('sns-list-container');
        const scrollableElement = document.querySelector('.sns-list-container');

        // =================================================================
        // 2. ìœ í‹¸ë¦¬í‹° ë° ì„¤ì •
        // =================================================================

        // ğŸ—“ï¸ ë‚ ì§œ í¬ë§· í•¨ìˆ˜: "YYYY-MM-DD" í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        const formatDate = (dateString) => {
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return dateString;
                
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                
                return `${year}-${month}-${day}`;
            } catch (e) {
                console.error("ë‚ ì§œ ë³€í™˜ ì˜¤ë¥˜:", e);
                return dateString;
            }
        };

        if (totalElement) {
            // allDataëŠ” ì™¸ë¶€ì—ì„œ ì œê³µë˜ëŠ” ë°ì´í„° ë°°ì—´ì´ë¼ê³  ê°€ì •
            totalElement.textContent = allData ? allData.length : 0;
        }

        if (container) container.innerHTML = ''; // ê¸°ì¡´ ì½˜í…ì¸  ì´ˆê¸°í™”

        let itemsPerPage = 20; // í˜ì´ì§€ë‹¹ ë¡œë“œí•  í•­ëª© ìˆ˜
        let loadedItems = 0;  // í˜„ì¬ ë¡œë“œëœ í•­ëª© ìˆ˜


        // =================================================================
        // 3. SNS ì•„ì´í…œ ìƒì„± í•¨ìˆ˜
        // =================================================================

        const createSnsItem = (data) => {
            const itemDiv = document.createElement('div');
            // data.source ê°’ì— ë”°ë¼ í´ë˜ìŠ¤ sns1 ë˜ëŠ” sns2ë¥¼ ì ìš©
            itemDiv.classList.add(data.source === 'google' ? 'sns1' : 'sns2'); 
            
            // <div class="title-wrapper">
            const titleWrapper = document.createElement('div');
            titleWrapper.classList.add('title-wrapper');

            // <img class="sns-icon"> (ì•„ì´ì½˜ ì†ŒìŠ¤ ê³ ì •)
            const icon = document.createElement('img');
            icon.src = '/static/img/naver.png';
            icon.alt = 'ë„¤ì´ë²„ ì•„ì´ì½˜';
            icon.classList.add('sns-icon');

            // <p> ì œëª© </p> (í´ë¦­ ì‹œ URL ì´ë™)
            // ğŸ’¡ <a> íƒœê·¸(í•˜ì´í¼ë§í¬)ë¥¼ ìƒì„±í•˜ì—¬ ë§í¬ ì´ë™ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
            const titleLink = document.createElement('a');

            // í…ìŠ¤íŠ¸ ë‚´ìš© ì„¤ì •
            titleLink.textContent = data.title;

            // dataì—ì„œ URLì„ ê°€ì ¸ì™€ href ì†ì„±ì— ì„¤ì • (data.url ë˜ëŠ” data.link ì¤‘ ì‹¤ì œ í‚¤ ì‚¬ìš©)
            titleLink.href = data.link; 

            // ìƒˆ íƒ­ì—ì„œ ì—´ë¦¬ë„ë¡ target ì†ì„± ì„¤ì •
            titleLink.target = '_blank'; 

            // <p> íƒœê·¸ì²˜ëŸ¼ ë³´ì´ê²Œ ìŠ¤íƒ€ì¼ ì ìš© (ì»¤ì„œ, ë°‘ì¤„ ì œê±° ë“±)
            titleLink.style.cursor = 'pointer'; 
            titleLink.style.textDecoration = 'none'; 
            titleLink.style.color = 'inherit'; // ë§í¬ ê¸°ë³¸ ìƒ‰ìƒ ëŒ€ì‹  í…ìŠ¤íŠ¸ ìƒ‰ìƒ ìƒì†

            titleWrapper.appendChild(icon);
            // ğŸ’¡ ìˆ˜ì •ëœ <a> íƒœê·¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
            titleWrapper.appendChild(titleLink);

            // <div class="meta-wrapper">
            const metaWrapper = document.createElement('div');
            metaWrapper.classList.add('meta-wrapper');

            // <span> ì‘ì„±ì </span>
            const authorSpan = document.createElement('span');
            authorSpan.textContent = data.author;

            // <span> ì‘ì„±ë‚ ì§œ </span>
            const dateSpan = document.createElement('span');
            dateSpan.textContent = formatDate(data.date);
            
            metaWrapper.appendChild(authorSpan);
            metaWrapper.appendChild(dateSpan);

            itemDiv.appendChild(titleWrapper);
            itemDiv.appendChild(metaWrapper);
            
            if (container) container.appendChild(itemDiv);
        };


        // =================================================================
        // 4. í•­ëª© ë¡œë“œ ë° ë¬´í•œ ìŠ¤í¬ë¡¤ ë¡œì§
        // =================================================================

        // í•­ëª© ë¡œë“œ í•¨ìˆ˜ (itemsPerPage ê°œìˆ˜ë§Œí¼ ì¶”ê°€ ë¡œë“œ)
        const loadMoreItems = () => {
            if (!allData || loadedItems >= allData.length) return; 
            
            const start = loadedItems;
            const end = Math.min(loadedItems + itemsPerPage, allData.length);

            if (start < end) {
                for (let i = start; i < end; i++) {
                    createSnsItem(allData[i]);
                }
                loadedItems = end;
            }
        };

        // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        if (scrollableElement) {
            scrollableElement.addEventListener('scroll', () => {
                // ìŠ¤í¬ë¡¤ì´ ëì—ì„œ 100px ì´ë‚´ë¡œ ë„ë‹¬í–ˆì„ ë•Œ ì¶”ê°€ ë¡œë“œ
                const isNearEnd = scrollableElement.scrollTop + scrollableElement.clientHeight >= scrollableElement.scrollHeight - 50;
                
                if (loadedItems < allData.length && isNearEnd) {
                    loadMoreItems();
                }
            });
        }

        // ============== ğŸš€ ìƒìœ„ 5ê°œ ë°ì´í„° ì½˜ì†” í™•ì¸ ë¡œì§ (ë””ë²„ê¹…ìš©) ==============
        if (allData && allData.length > 0) {
            console.log("--- ìƒìœ„ 5ê°œ ê²Œì‹œë¬¼ ë°ì´í„° (ë””ë²„ê¹…ìš©) ---");
            
            const top5Items = allData.slice(0, 5);
            
            top5Items.forEach((data, index) => {
                const formattedDate = formatDate(data.date);
                
                console.log(`[${index + 1}ìœ„] ì œëª©: ${data.title}, ì‘ì„±ì: ${data.author}, ì‘ì„± ë‚ ì§œ: ${formattedDate}, URL: ${data.link}`);
            });
            
            console.log("------------------------------------------");
        }

        // ============= âœ… ì´ˆê¸° ë¡œë“œ (í˜ì´ì§€ ë¡œë“œ ì‹œ ìµœì´ˆ 5ê°œ í•­ëª© í‘œì‹œ) =============
        if (allData && allData.length > 0) {
            loadMoreItems(); 
        }

        // ğŸš€ í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° í•­ëª© ë¡œë“œ
        loadMoreItems();
        
        // --- 2E. ğŸ’¡ ì–¸ê¸‰ëŸ‰ ì¶”ì´ ê·¸ë˜í”„ í† ê¸€ ë²„íŠ¼ (ì£¼ë³„/ì›”ë³„) ---
        const toggleButtons = document.querySelectorAll('.toggle-btn');
        const frequencyGraph = document.getElementById('frequency-graph');

        if (toggleButtons && frequencyGraph) {
            toggleButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const frequency = button.getAttribute('data-frequency');

                    // ëª¨ë“  ë²„íŠ¼ì—ì„œ 'active' í´ë˜ìŠ¤ ì œê±°
                    toggleButtons.forEach(btn => btn.classList.remove('active'));

                    // í´ë¦­í•œ ë²„íŠ¼ì— 'active' í´ë˜ìŠ¤ ì¶”ê°€
                    button.classList.add('active');

                    // ë¹ˆë„ì— ë”°ë¼ ì´ë¯¸ì§€ URL ë³€ê²½
                    if (frequency === 'weekly') {
                        frequencyGraph.src = "{{ data.visualization_urls.weekly_frequency }}";
                        frequencyGraph.alt = 'ì£¼ë³„ ì–¸ê¸‰ëŸ‰ ì¶”ì´ ê·¸ë˜í”„';
                    } else if (frequency === 'monthly') {
                        frequencyGraph.src = "{{ data.visualization_urls.monthly_frequency }}";
                        frequencyGraph.alt = 'ì›”ë³„ ì–¸ê¸‰ëŸ‰ ì¶”ì´ ê·¸ë˜í”„';
                    }

                    console.log(`ì–¸ê¸‰ëŸ‰ ì¶”ì´ ê·¸ë˜í”„ ë³€ê²½: ${frequency}`);
                });
            });
        } else {
            console.warn("í† ê¸€ ë²„íŠ¼ ë˜ëŠ” ê·¸ë˜í”„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        });
    </script>
    {% endif %}
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // 1. ë©”ì¸ ê²€ìƒ‰ í¼ ì²˜ë¦¬ (ì „ì²´ í™”ë©´ ë¡œë”©)
        const mainForm = document.getElementById('searchForm');
        const globalLoader = document.getElementById('global-loader');
        const mainInput = document.querySelector('.search-input-first');

        if (mainForm) {
            mainForm.addEventListener('submit', function(e) {
                // ì…ë ¥ê°’ì´ ìˆì„ ë•Œë§Œ ë¡œë”© í‘œì‹œ
                if (mainInput && mainInput.value.trim() !== "") {
                    if (globalLoader) globalLoader.style.display = 'flex'; 
                }
            });
        }

        // 2. ê²½ìŸì‚¬ ë¶„ì„ í¼ ì²˜ë¦¬ (ì¹´ë“œ ë‚´ë¶€ ë¡œë”©)
        const compForm = document.getElementById('competitorForm');
        const compLoader = document.getElementById('competitor-loader');
        const compInput = document.querySelector('input[name="competitor-search"]');

        // ê²½ìŸì‚¬ ê²€ìƒ‰ ì‹œ, ë©”ì¸ ê²€ìƒ‰ì–´ë„ ìœ ì§€í•˜ê¸° ìœ„í•´ hidden input ì¶”ê°€
        if (compForm) {
            compForm.addEventListener('submit', function(e) {
                // ë©”ì¸ ê²€ìƒ‰ì–´ ê°’ ê°€ì ¸ì˜¤ê¸°
                const mainSearchVal = mainInput ? mainInput.value : "";
                
                // ê¸°ì¡´ì— hidden inputì´ ì—†ìœ¼ë©´ ìƒì„±
                let hiddenMain = compForm.querySelector('input[name="main-search"]');
                if (!hiddenMain) {
                    hiddenMain = document.createElement('input');
                    hiddenMain.type = 'hidden';
                    hiddenMain.name = 'main-search';
                    compForm.appendChild(hiddenMain);
                }
                hiddenMain.value = mainSearchVal;

                if (compInput && compInput.value.trim() !== "") {
                    if (compLoader) compLoader.style.display = 'flex';
                }
            });
        }
    });
  </script>
  {% if error %}
  <script>
      // 1. ê²½ê³ ì°½ ë„ìš°ê¸°
      alert("{{ error }}");
      
      // 2. (ì„ íƒì‚¬í•­) í™•ì¸ ëˆ„ë¥´ë©´ ì£¼ì†Œì°½ì„ ê¹¨ë—í•˜ê²Œ ì´ˆê¸°í™” (ë©”ì¸ìœ¼ë¡œ ì´ë™)
      window.location.href = "/";
  </script>
  {% endif %}
  </body>
</html>
